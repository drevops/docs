"use strict";(self.webpackChunkscaffold=self.webpackChunkscaffold||[]).push([[4459],{1040:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>t,metadata:()=>r,toc:()=>a});var i=o(4848),s=o(8453);const t={},l="Deployment",r={id:"workflows/deployment",title:"Deployment",description:"The deployment to a remote location is performed by the",source:"@site/content/workflows/deployment.mdx",sourceDirName:"workflows",slug:"/workflows/deployment",permalink:"/workflows/deployment",draft:!1,unlisted:!1,editUrl:"https://github.com/drevops/scaffold/tree/develop/.scaffold/docs/content/workflows/deployment.mdx",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Build",permalink:"/workflows/build"},next:{title:"Development",permalink:"/workflows/development"}},c={},a=[{value:"Using deployments",id:"using-deployments",level:2},{value:"Deployment action",id:"deployment-action",level:3},{value:"Skipping deployments for specific Pull Requests or branches",id:"skipping-deployments-for-specific-pull-requests-or-branches",level:3},{value:"Skipping a specific Pull Request:",id:"skipping-a-specific-pull-request",level:4},{value:"Skipping a specific branch:",id:"skipping-a-specific-branch",level:4}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"deployment",children:"Deployment"}),"\n",(0,i.jsxs)(n.p,{children:["The deployment to a remote location is performed by the\n",(0,i.jsx)(n.a,{href:"https://github.com/drevops/scaffold/blob/develop/scripts/drevops/deploy.sh",children:(0,i.jsx)(n.code,{children:"scripts/drevops/deploy.sh"})})," ",(0,i.jsx)(n.em,{children:"router"}),"\nscript."]}),"\n",(0,i.jsx)(n.p,{children:"The script runs in CI only after all tests pass."}),"\n",(0,i.jsxs)(n.p,{children:["The script deploys the  code to a remote location by calling the\nrelevant scripts based on the type of deployment defined in ",(0,i.jsx)(n.code,{children:"$DREVOPS_DEPLOY_TYPES"}),"\nvariable as a comma-separated list of one or multiple supported deployment types:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"webhook"})," - a webhook URL is called via CURL."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"artifact"})," - a code artifact created and sent to a remote repository."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"lagoon"})," - a special webhook URL is called via CURL to trigger a deployment in\nLagoon."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"docker"}),"- a container image is built and pushed to a remote registry."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"using-deployments",children:"Using deployments"}),"\n",(0,i.jsx)(n.h3,{id:"deployment-action",children:"Deployment action"}),"\n",(0,i.jsxs)(n.p,{children:["By default, an existing database will be retained during a deployment. To change\nthis behavior and overwrite the database, set the ",(0,i.jsx)(n.code,{children:"$DREVOPS_DEPLOY_ACTION"}),"\nvariable to ",(0,i.jsx)(n.code,{children:"deploy_override_db"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"skipping-deployments-for-specific-pull-requests-or-branches",children:"Skipping deployments for specific Pull Requests or branches"}),"\n",(0,i.jsxs)(n.p,{children:["To skip a specific Pull Request or branch using the ",(0,i.jsx)(n.code,{children:"$DREVOPS_DEPLOY_SKIP"}),"\nvariable, you would define additional environment variables with a specific\nnaming convention in your CI configuration."]}),"\n",(0,i.jsx)(n.p,{children:"Here's an example of how this can be done:"}),"\n",(0,i.jsx)(n.h4,{id:"skipping-a-specific-pull-request",children:"Skipping a specific Pull Request:"}),"\n",(0,i.jsx)(n.p,{children:"Suppose you want to skip the deployment for Pull Request number 42. You would\nset the following environment variable:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"DREVOPS_DEPLOY_SKIP_PR_42=1\n"})}),"\n",(0,i.jsx)(n.h4,{id:"skipping-a-specific-branch",children:"Skipping a specific branch:"}),"\n",(0,i.jsxs)(n.p,{children:["Suppose you want to skip the deployment for a branch named ",(0,i.jsx)(n.code,{children:"feature-x"}),'. You\nwould first create a "safe" version of the branch name by replacing any\nspecial characters with underscores.']}),"\n",(0,i.jsx)(n.p,{children:"Set the following environment variable:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"DREVOPS_DEPLOY_SKIP_BRANCH_FEATURE_X=1\n"})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>l,x:()=>r});var i=o(6540);const s={},t=i.createContext(s);function l(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);