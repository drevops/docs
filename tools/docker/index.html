<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tools/docker" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Docker | Scaffold for Drupal</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.drevops.com/img/drevops_services_dark.png"><meta data-rh="true" name="twitter:image" content="https://docs.drevops.com/img/drevops_services_dark.png"><meta data-rh="true" property="og:url" content="https://docs.drevops.com/tools/docker"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Docker | Scaffold for Drupal"><meta data-rh="true" name="description" content="https://github.com/docker/cli"><meta data-rh="true" property="og:description" content="https://github.com/docker/cli"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.drevops.com/tools/docker"><link data-rh="true" rel="alternate" href="https://docs.drevops.com/tools/docker" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.drevops.com/tools/docker" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9T1JR2V5RL"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-9T1JR2V5RL",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.8ddc1583.css">
<script src="/assets/js/runtime~main.b1d2e368.js" defer="defer"></script>
<script src="/assets/js/main.29f39a86.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-dark.svg" alt="Scaffold Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo-light.svg" alt="Scaffold Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/drupal">Drupal</a><a class="navbar__item navbar__link" href="/workflows">Workflows</a><a class="navbar__item navbar__link" href="/tools">Tools</a><a class="navbar__item navbar__link" href="/integrations">Integrations</a><a class="navbar__item navbar__link" href="/contributing">Contributing</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/drevops/scaffold" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" title="View source on GitHub">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/getting-started/">Getting started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/drupal/">Drupal</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/workflows/">Workflows</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/tools/">Tools</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tools/">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tools/ahoy">Ahoy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tools/behat">Behat</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/tools/docker">Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tools/doctor">Doctor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tools/drush">Drush</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tools/git-artifact">Git artifact</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tools/hadolint">Hadolint</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tools/phpcs">PHPCS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tools/phpmd">PHPMD</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tools/phpstan">PHPStan</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tools/phpunit">PHPUnit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tools/pygmy">Pygmy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tools/rector">Rector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tools/renovate">Renovate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tools/twig-cs-fixer">Twig CS Fixer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tools/xdebug">Xdebug</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/integrations/">Integrations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/contributing/">Contributing</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tools</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Docker</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Docker</h1>
<p><a href="https://github.com/docker/cli" target="_blank" rel="noopener noreferrer">https://github.com/docker/cli</a>
<a href="https://github.com/docker/compose" target="_blank" rel="noopener noreferrer">https://github.com/docker/compose</a></p>
<blockquote>
<p>Docker is a platform for developing, shipping, and running applications in
containers.</p>
</blockquote>
<p>Scaffold provides a configuration for Docker and Docker Compose to run the
project in all environments using containers.</p>
<p>Special thanks to Lagoon for providing
the <a href="https://github.com/uselagoon/lagoon-images" target="_blank" rel="noopener noreferrer">container images</a>
that make this possible.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Lagoon images are <strong>production-grade</strong> and are used in production environments.
They receive regular updates and are maintained by the Lagoon team.</p><p>If you are using Lagoon as your hosting provider, then all of your
environments are using identical images to run the project.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="about-docker-and-docker-compose">About Docker and Docker Compose<a href="#about-docker-and-docker-compose" class="hash-link" aria-label="Direct link to About Docker and Docker Compose" title="Direct link to About Docker and Docker Compose">​</a></h2>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Below is a brief overview of Docker and Docker Compose. For more information,
see the official documentation.</p></div></div>
<p>Docker is a technology that allows to define services such as a web server or
a database server as standalone <em>containers</em>, which are then run in an isolated
environment and can talk to each other.</p>
<p>The containers are started from <em>images</em> - templates that define what is
installed
in the container and how it is configured. <em>Images</em> allow to run <em>containers</em>
with consistent content and configuration.</p>
<p>Docker is an engine that runs containers, built from images, allowing them to
share host system resources and communicate to each other. When run locally,
Docker can be controlled with Docker CLI command, called <code>docker</code>.</p>
<p>Docker Compose is a tool that allows to define and run multi-container Docker
applications in a single <code>docker-compose.yml</code> file: multiple containers that
work together can be described in a single file, which makes it easier to
manage them.</p>
<p>When working with Drupal, which requires multiple service containers to run, a
developer would normally use Docker Compose CLI commands (rather than Docker CLI
commands) called <code>docker compose</code>. Note that this
commands runs in the context of the current directory, so it is important to
run them from the project root directory. This means that the issued commands
will only affect the containers defined in the <code>docker-compose.yml</code> file in the
current directory and will not affect any other containers running on the host.</p>
<p>When a project is fully configured, the usage of Docker-based application comes
down to a handful of commands to manage the state of the containers (per
project):</p>
<ul>
<li><code>docker compose up -d</code> - start the containers in the background.</li>
<li><code>docker compose down</code> - stop and remove the containers.</li>
<li><code>docker compose exec &lt;service&gt;</code> - run a command in a running <code>&lt;service&gt;</code>
container.</li>
<li><code>docker compose logs -f</code> - follow the logs of all the containers.</li>
<li><code>docker compose ps</code> - list all running containers.</li>
</ul>
<p>More advanced commands are normally used when adjusting the project Docker
configuration and services.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-docker">Using Docker<a href="#using-docker" class="hash-link" aria-label="Direct link to Using Docker" title="Direct link to Using Docker">​</a></h2>
<p>Scaffold uses Docker to run the project in a containerized environment locally
and in CI.</p>
<p>Some of the commands are wrapped in the Ahoy script as a shorthand. But all
the commands can be run directly using <code>docker compose</code> command.</p>
<p>Specific commands are described in the relevant <a href="/workflows">workflows</a>
sections.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="understanding-docker-composeyml">Understanding <code>docker-compose.yml</code><a href="#understanding-docker-composeyml" class="hash-link" aria-label="Direct link to understanding-docker-composeyml" title="Direct link to understanding-docker-composeyml">​</a></h2>
<p>Docker Compose reads the configuration from the <code>docker-compose.yml</code> and
<code>docker-compose.override.yml</code> files. The configuration files are written in
YAML,
which <a href="http://blog.daemonl.com/2016/02/yaml.html" target="_blank" rel="noopener noreferrer">support anchors and references</a>
that help to reduce duplication.</p>
<p>The file provided by Scaffold contains the following sections:</p>
<ul>
<li><a href="#volumes-definitions">Volumes definitions</a></li>
<li><a href="#default-user">Default user</a></li>
<li><a href="#environment-variables">Environment variables</a></li>
<li><a href="#services">Services</a></li>
<li><a href="#networks">Networks</a></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="volumes-definitions">Volumes definitions<a href="#volumes-definitions" class="hash-link" aria-label="Direct link to Volumes definitions" title="Direct link to Volumes definitions">​</a></h3>
<p>Volumes are used to share data between containers. If the host supports volume
mounting, then the data can be shared between containers through the host,
making it possible to access and modify the data from the host.</p>
<p>This is used during development to share the application code between the
container and the host, so that the changes made on the host are immediately
reflected in the running application.</p>
<p>There are 2 volumes defined:</p>
<ul>
<li>Project root directory <code>.</code> maps to <code>/app</code> directory within a container. This
is where a PHP engine accesses the application code.</li>
<li>Files directory <code>./web/sites/default/files</code> maps
to <code>/app/web/sites/default/files</code> directory within a container as an override
to the default volume definition. This allows to use different type of syncing
to optimise performance, because files are not changed as often as the code.</li>
</ul>
<p>There are 2 more volumes defined and commented out - these are used in
environments without volume mounting support, such as CircleCI. These volumes
definitions are automatically uncommented in CI environment, and they replace
the host volume mounting, which is removed.</p>
<p><code>VOLUME_FLAGS</code> environment variable allows to define the consistency of the data
within mounted volumes. The values are:</p>
<ul>
<li><code>default</code>: Equivalent to <code>consistent</code>.</li>
<li><code>consistent</code>: Full consistency. The container runtime and the host maintain an
identical view of the mount at all times.</li>
<li><code>cached</code>: The host&#x27;s view of the mount is authoritative. There may be delays
before updates made on the host are visible within a container.</li>
<li><code>delegated</code>: The container runtime&#x27;s view of the mount is authoritative. There
may be delays before updates made in a container are visible on the host.</li>
</ul>
<p>The default value is <code>delegated</code>, so that any changes done in the container are
immediately visible on the host.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="default-user">Default user<a href="#default-user" class="hash-link" aria-label="Direct link to Default user" title="Direct link to Default user">​</a></h3>
<p>The default user is defined as <code>1000</code> - this is the user ID that is used in the
container to run the application. This is the same user ID as the host user, so
that the files created in the container are owned by the host user.</p>
<p>Changes this value if your user ID is different.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="environment-variables">Environment variables<a href="#environment-variables" class="hash-link" aria-label="Direct link to Environment variables" title="Direct link to Environment variables">​</a></h3>
<p>By default, the Docker Composer reads environment variables from the <code>.env</code>
file. Scaffold provides an additional capability to read files from <code>.env.local</code>
file as well. This allows to override the environment variables locally without
modifying the <code>.env</code> file.</p>
<p>The variables read from <code>.env</code> and <code>.env.local</code> files then passed into the
containers.</p>
<p>This section only defines 2 types of variables:</p>
<ol>
<li>Variables that are specific to the stack and require a default value (
like <code>LAGOON_ROUTE</code>).</li>
<li>Variables that cannot be stored in <code>.env</code> file and are injected from the
actual environment (like secrets).</li>
</ol>
<p>Any other variables should be defined in the <code>.env</code> file.</p>
<p>Consider the example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  TZ: ${DREVOPS_TZ:-Australia/Melbourne}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Local development URL.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DREVOPS_LOCALDEV_URL: &amp;default-url ${COMPOSE_PROJECT_NAME:-example-site}.docker.amazee.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # Local development route used in Lagoon images and Pygmy to route requests.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  LAGOON_ROUTE: *default-url</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>where</p>
<ul>
<li><code>TZ: ${DREVOPS_TZ:-Australia/Melbourne}</code> - defines a variable <code>TZ</code> with a
default value of <code>Australia/Melbourne</code>, but only if <code>DREVOPS_TZ</code> variable is
not defined.</li>
<li><code>DREVOPS_LOCALDEV_URL: &amp;default-url ${COMPOSE_PROJECT_NAME:-example-site}.docker.amazee.io</code>
<ul>
<li>defines a variable <code>DREVOPS_LOCALDEV_URL</code> with a default value of
<code>${COMPOSE_PROJECT_NAME:-example-site}.docker.amazee.io</code>, but only if
<code>DREVOPS_LOCALDEV_URL</code> variable is not defined. The value of the variable
is also stored in a YAML anchor <code>default-url</code> for later use.</li>
</ul>
</li>
<li><code>LAGOON_ROUTE: *default-url</code> - defines a variable <code>LAGOON_ROUTE</code> with a value
of <code>*default-url</code>, which is a reference to the <code>default-url</code> YAML anchor
defined above.</li>
</ul>
<p>See more information about environment variables in
the <a href="https://docs.docker.com/compose/environment-variables/set-environment-variables/" target="_blank" rel="noopener noreferrer">official documentation</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="services">Services<a href="#services" class="hash-link" aria-label="Direct link to Services" title="Direct link to Services">​</a></h3>
<p>Services section describes the configuration for each container.</p>
<p>The following services are defined in the <code>docker-compose.yml</code> file provided by
Scaffold:</p>
<ul>
<li><code>cli</code> - a container that runs a shell. This container is used to run commands
in the context of the project, such as <code>composer</code> or <code>drush</code>. This is also a
container where cron jobs are run within a hosting environment (if that
environment supports containerisation).</li>
<li><code>nginx</code> - a container that runs a web server. This container is used to serve
the application and pass requests to the PHP container.</li>
<li><code>php</code> - a container that runs a PHP engine. This container is used to run the
application code and execute commands in the context of the application. It is
different from the <code>cli</code> container in that it does not have certain
development dependencies installed, has a smaller size and is optimised for
scalability.</li>
<li><code>mariadb</code> - a container that runs a database server. This container is used to
store the application data. It can be accessed from the host via a randomly
assigned port - run <code>docker compose port mariadb 3306</code> to get the port number.</li>
<li><code>redis</code> - an optional container that runs a Redis server. This container is
used to store the application cache.</li>
<li><code>solr</code> - an optional container that runs a Solr server. This container is used
to store the application search index. It can be accessed from the host via a
randomly assigned port - run <code>docker compose port solr 8983</code> to get the port
number.</li>
<li><code>clamav</code> - an optional container that runs a ClamAV antivirus server. This
container is used to scan uploaded files for viruses.<!-- -->
<ul>
<li><code>chrome</code> - container that runs a Chrome browser. This container is
used to run Behat tests. It is based on the official Selenium image which has
additional required tools, like virtual desktop, installed.</li>
</ul>
</li>
<li><code>wait_dependencies</code> - a container that runs a script to wait for applications
within other containers to become available. Docker itself can coordinate
startup of containers, but it does not know when the application within the
container is ready to accept connections. This container is used to wait for
specified application ports to become available. The whole stack is considered
ready to be worked with only when this container exits with a zero exit code.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="networks">Networks<a href="#networks" class="hash-link" aria-label="Direct link to Networks" title="Direct link to Networks">​</a></h3>
<p>Networks section defines the networks that are used to connect containers to
each other. <a href="/tools/pygmy">Pygmy</a> provides the default <code>amazeeio-network</code> network
that
is used to connect all containers together.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="validate-docker-composeyml">Validate <code>docker-compose.yml</code><a href="#validate-docker-composeyml" class="hash-link" aria-label="Direct link to validate-docker-composeyml" title="Direct link to validate-docker-composeyml">​</a></h2>
<p>After updating the <code>docker-compose.yml</code> file, it is useful sometimes to validate
it before running the build. This can be done with the following command:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> compose </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> docker-compose.yml config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/drevops/scaffold/tree/develop/.scaffold/docs/content/tools/docker.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/tools/behat"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Behat</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tools/doctor"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Doctor</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#about-docker-and-docker-compose" class="table-of-contents__link toc-highlight">About Docker and Docker Compose</a></li><li><a href="#using-docker" class="table-of-contents__link toc-highlight">Using Docker</a></li><li><a href="#understanding-docker-composeyml" class="table-of-contents__link toc-highlight">Understanding <code>docker-compose.yml</code></a><ul><li><a href="#volumes-definitions" class="table-of-contents__link toc-highlight">Volumes definitions</a></li><li><a href="#default-user" class="table-of-contents__link toc-highlight">Default user</a></li><li><a href="#environment-variables" class="table-of-contents__link toc-highlight">Environment variables</a></li><li><a href="#services" class="table-of-contents__link toc-highlight">Services</a></li><li><a href="#networks" class="table-of-contents__link toc-highlight">Networks</a></li></ul></li><li><a href="#validate-docker-composeyml" class="table-of-contents__link toc-highlight">Validate <code>docker-compose.yml</code></a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a href="https://github.com/drevops/scaffold" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ©2024 DrevOps. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>